<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>ì´ˆ6 ë¼ˆÂ·ê·¼ìœ¡ ì§€ì‹ë´‡</title>
  <style>
    :root { --bg:#0b1020; --card:#111a33; --line:#233056; --txt:#e9eefc; --sub:#b9c4ea; }
    body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,"Noto Sans KR",sans-serif;background:var(--bg);color:var(--txt);}
    .wrap{max-width:920px;margin:0 auto;padding:16px;}
    .card{background:var(--card);border:1px solid var(--line);border-radius:14px;overflow:hidden;box-shadow:0 10px 30px rgba(0,0,0,.25);}
    .topbar{display:flex;gap:10px;align-items:center;justify-content:space-between;flex-wrap:wrap;
      padding:12px;border-bottom:1px solid var(--line);background:rgba(255,255,255,.02);}
    .pill{font-size:12px;color:var(--sub);border:1px solid var(--line);padding:6px 10px;border-radius:999px;background:rgba(255,255,255,.02);}
    .namebox{display:flex;gap:8px;align-items:center;flex-wrap:wrap;}
    .namebox input{width:140px;padding:10px 10px;border-radius:12px;border:1px solid var(--line);background:#0e1630;color:var(--txt);outline:none;}
    .namebox button,.bar button{padding:10px 12px;border-radius:12px;border:1px solid var(--line);
      background:rgba(122,162,255,.18);color:var(--txt);cursor:pointer;font-weight:800;}
    .namebox button:hover,.bar button:hover{background:rgba(122,162,255,.28);}

    .msgs{height:60vh;min-height:380px;overflow:auto;padding:14px;display:flex;flex-direction:column;gap:10px;}
    .msg{max-width:82%;padding:10px 12px;border-radius:14px;border:1px solid var(--line);line-height:1.5;white-space:pre-wrap;}
    .bot{background:rgba(122,162,255,.08);align-self:flex-start;}
    .me{background:rgba(255,255,255,.06);align-self:flex-end;}

    .chips{display:flex;flex-wrap:wrap;gap:8px;padding:10px 12px;border-top:1px solid var(--line);background:rgba(255,255,255,.02);}
    .chip{font-size:12px;color:var(--sub);border:1px solid var(--line);padding:7px 10px;border-radius:999px;cursor:pointer;user-select:none;}
    .chip:hover{color:var(--txt);border-color:rgba(122,162,255,.6);}

    .bar{display:flex;gap:10px;padding:12px;border-top:1px solid var(--line);}
    .bar input{flex:1;padding:12px 12px;border-radius:12px;border:1px solid var(--line);background:#0e1630;color:var(--txt);outline:none;}

    .searchBtn{margin-top:8px;padding:10px 12px;border-radius:12px;border:1px solid var(--line);
      background:rgba(122,162,255,.25);color:var(--txt);cursor:pointer;font-weight:900;width:fit-content;}
    .searchBtn:hover{background:rgba(122,162,255,.35);}

    .small{font-size:12px;color:var(--sub);margin-top:10px;line-height:1.5;}
    code.k{background:rgba(255,255,255,.06);padding:2px 6px;border-radius:8px;border:1px solid var(--line);}
  </style>
</head>
<body>
<div class="wrap">
  <div class="card">
    <div class="topbar">
      <div style="display:flex;gap:10px;align-items:center;flex-wrap:wrap;">
        <div id="status" class="pill">ì´ë¦„: - | ì¹­í˜¸: ì…ë¬¸ì | ì§ˆë¬¸ 0ê°œ</div>
        <div class="pill">ê²¹ì¹˜ì§€ ì•ŠëŠ” ì§ˆë¬¸ë§Œ ì¹´ìš´íŠ¸!</div>
      </div>
      <div class="namebox">
        <input id="nameInput" placeholder="ì´ë¦„ ì…ë ¥" />
        <button id="setNameBtn">ì´ë¦„ ì„¤ì •</button>
        <button id="resetBtn" title="í˜„ì¬ ì´ë¦„ ê¸°ë¡ ì´ˆê¸°í™”">ì´ˆê¸°í™”</button>
      </div>
    </div>

    <div id="msgs" class="msgs"></div>

    <div class="chips" id="chips"></div>

    <div class="bar">
      <input id="q" placeholder="ì˜ˆ) íŒ”ì´ ì™œ êµ½í˜€ì ¸? / ê°€ì¥ í° ë¼ˆ ë­ì•¼? / ê·¼ìœ¡ ì™œ ë–¨ë ¤?" autocomplete="off" />
      <button id="askBtn">ì§ˆë¬¸</button>
    </div>
  </div>

  <div class="small">
    â€¢ ì´ ë²„ì „ì€ â€œí‚¤ì›Œë“œ/ë™ì˜ì–´ ë§¤ì¹­â€ì´ë¼ì„œ ë§ì´ ì¡°ê¸ˆ ë‹¬ë¼ë„ ì•Œì•„ë“£ê²Œ ì„¤ê³„í–ˆì–´.<br/>
    â€¢ ê¸°ë¡ì€ ì´ ê¸°ê¸°(ë¸Œë¼ìš°ì €)ì— ì €ì¥ë¼. ë‹¤ë¥¸ ê¸°ê¸°ì—ì„œëŠ” ë”°ë¡œ ì €ì¥ë¼.
  </div>
</div>

<script>
/* =========================
   0) ì €ì¥í‚¤ / ì¹­í˜¸
========================= */
const STORE_KEY="bbot_records_final_c1";
const NAME_KEY ="bbot_current_name_final_c1";

const TITLES=[
  {n:1,t:"íƒí—˜ê°€"},{n:3,t:"ë¼ˆ ê²¬ìŠµìƒ"},{n:5,t:"ê·¼ìœ¡ ì—°êµ¬ì›"},
  {n:8,t:"ê´€ì ˆ ì „ë¬¸ê°€"},{n:12,t:"ì¸ì²´ ë°•ì‚¬"},{n:20,t:"í•´ë¶€í•™ ë§ˆìŠ¤í„°"}
];

const $=s=>document.querySelector(s);
const msgsEl=$("#msgs"), qEl=$("#q"), statusEl=$("#status"), nameInput=$("#nameInput");

/* =========================
   1) ìœ í‹¸
========================= */
function addMsg(text,who="bot"){
  const div=document.createElement("div");
  div.className=`msg ${who}`;
  div.textContent=text;
  msgsEl.appendChild(div);
  msgsEl.scrollTop=msgsEl.scrollHeight;
}
function normalize(s){
  return (s||"")
    .toLowerCase()
    .replace(/\s+/g," ")
    .replace(/[?!.,"'â€™â€œâ€()]/g,"")
    .trim();
}

/* =========================
   2) êµ¬ê¸€ ë²„íŠ¼(ëª¨ë¥´ëŠ” ì§ˆë¬¸)
========================= */
function addSearchButton(query){
  const box=document.createElement("div");
  box.className="msg bot";

  const txt=document.createElement("div");
  txt.textContent="ì´ê±´ ì•„ì§ ë°ì´í„°ì— ì—†ëŠ” ì§ˆë¬¸ì´ì•¼! ğŸ” êµ¬ê¸€ì—ì„œ ì°¾ì•„ë³´ê³ , ë‹µì„ í™•ì¸í•œ ë‹¤ìŒ ë‹¤ì‹œ ëŒì•„ì˜¤ì„¸ìš” ğŸ™‚";

  const btn=document.createElement("button");
  btn.className="searchBtn";
  btn.textContent="êµ¬ê¸€ì—ì„œ ì°¾ì•„ë³´ê¸°";
  btn.onclick=()=>window.open("https://www.google.com/search?q="+encodeURIComponent(query),"_blank");

  box.appendChild(txt); box.appendChild(btn);
  msgsEl.appendChild(box);
  msgsEl.scrollTop=msgsEl.scrollHeight;
}

/* =========================
   3) ì´ë¦„ë³„ ì €ì¥
========================= */
function loadAll(){
  try{ return JSON.parse(localStorage.getItem(STORE_KEY)||"{}"); }catch{ return {}; }
}
function saveAll(all){ localStorage.setItem(STORE_KEY, JSON.stringify(all)); }
function getCurrentName(){ return (localStorage.getItem(NAME_KEY)||"").trim(); }
function setCurrentName(n){ localStorage.setItem(NAME_KEY,n); }

function ensureUser(all,name){
  if(!all[name]) all[name]={ askedNorm:[], askedRaw:[] };
  return all[name];
}
function getTitle(count){
  let title="ì…ë¬¸ì";
  for(const t of TITLES) if(count>=t.n) title=t.t;
  return title;
}
function updateStatus(){
  const all=loadAll();
  const name=getCurrentName()||"-";
  const u=(name!=="-")?ensureUser(all,name):{askedNorm:[]};
  const count=u.askedNorm.length;
  statusEl.textContent=`ì´ë¦„: ${name} | ì¹­í˜¸: ${getTitle(count)} | ì§ˆë¬¸ ${count}ê°œ`;
}

/* =========================
   4) ì§€ì‹ë² ì´ìŠ¤(í‚¤ì›Œë“œ/ë™ì˜ì–´ ë§¤ì¹­)
   - keys: í•™ìƒë“¤ì´ ì“¸ ë²•í•œ í‘œí˜„ ë¬¶ìŒ
   - a: 3~5ë¬¸ì¥, êµê³¼ ìˆ˜ì¤€, ìˆ˜ì¶•/ì´ì™„ í—ˆìš©
========================= */
const KB = [
  {
    keys:["ê°€ì¥ í° ë¼ˆ","í° ë¼ˆ","ì œì¼ í° ë¼ˆ","ëŒ€í‡´ê³¨","í—ˆë²…ì§€ ë¼ˆ"],
    a:`ê°€ì¥ í° ë¼ˆëŠ” í—ˆë²…ì§€ ë¼ˆì¸ ëŒ€í‡´ê³¨ì´ì•¼.
ëª¸ë¬´ê²Œë¥¼ ë²„í‹°ê³  ê±¸ì„ ë•Œ í° í˜ì„ ë°›ì•„ì„œ ê¸¸ê³  íŠ¼íŠ¼í•´.`
  },
  {
    keys:["ê°€ì¥ ì‘ì€ ë¼ˆ","ì œì¼ ì‘ì€ ë¼ˆ","ì‘ì€ ë¼ˆ","ë“±ìë¼ˆ","ê·€ ë¼ˆ","ê·€ ì•ˆ ë¼ˆ"],
    a:`ê°€ì¥ ì‘ì€ ë¼ˆëŠ” ê·€ ì•ˆì— ìˆëŠ” ë“±ìë¼ˆì•¼.
ìŒ€ì•Œë³´ë‹¤ ì‘ê³  ì†Œë¦¬ì˜ ì§„ë™ì„ ì „ë‹¬í•´.`
  },
  {
    keys:["ë¼ˆ ëª‡ ê°œ","ë¼ˆ ê°œìˆ˜","ë¼ˆëŠ” ëª‡ê°œ","ì‚¬ëŒ ë¼ˆ ëª‡","ì„±ì¸ ë¼ˆ ëª‡","206"],
    a:`ì–´ë¥¸ì€ ë¼ˆê°€ 206ê°œì•¼.
ì•„ê¸°ëŠ” ë¼ˆê°€ ë”°ë¡œë”°ë¡œ ì‹œì‘í•´ì„œ ìë¼ë©´ì„œ ì„œë¡œ ë¶™ê¸°ë„ í•´ì„œ ê°œìˆ˜ê°€ ì¤„ì–´ë“¤ì–´.`
  },
  {
    keys:["ê°ˆë¹„ë¼ˆ","ê°ˆë¹„ ë¼ˆ","rib","24ê°œ","12ìŒ"],
    a:`ê°ˆë¹„ë¼ˆëŠ” 12ìŒ, ì´ 24ê°œì•¼.
ì‹¬ì¥ê³¼ íë¥¼ ë³´í˜¸í•˜ê³ , ìˆ¨ ì‰´ ë•Œ ê°€ìŠ´ì´ ì›€ì§ì´ê²Œ ë„ì™€ì¤˜.`
  },
  {
    keys:["ì²™ì¶”","ë“±ë¼ˆ","ì²™ì¶”ë¼ˆ","ì²™ì¶” ëª‡","26ê°œ"],
    a:`ì–´ë¥¸ì˜ ì²™ì¶”ë¼ˆëŠ” 26ê°œì•¼.
ëª¸ì„ ì„¸ìš°ê³  ëª¸í†µì„ êµ¬ë¶€ë¦¬ê±°ë‚˜ ë¹„í‹€ ìˆ˜ ìˆê²Œ í•´.`
  },
  {
    keys:["ì†ê°€ë½ ë¼ˆ","ì†ê°€ë½ë¼ˆ","ì†ê°€ë½ ëª‡ê°œ","ì†ê°€ë½ 14","í•œ ì† 14"],
    a:`í•œ ì†ì˜ ì†ê°€ë½ë¼ˆëŠ” 14ê°œì•¼.
ì—„ì§€ëŠ” 2ê°œ, ë‚˜ë¨¸ì§€ ë„¤ ì†ê°€ë½ì€ 3ê°œì”©ì´ì•¼.`
  },
  {
    keys:["ë°œê°€ë½ ë¼ˆ","ë°œê°€ë½ë¼ˆ","ë°œê°€ë½ ëª‡ê°œ","ë°œê°€ë½ 14","í•œ ë°œ 14"],
    a:`í•œ ë°œì˜ ë°œê°€ë½ë¼ˆëŠ” 14ê°œì•¼.
ì—„ì§€ë°œê°€ë½ì€ 2ê°œ, ë‚˜ë¨¸ì§€ëŠ” 3ê°œì”©ì´ì•¼.`
  },
  {
    keys:["ë¼ˆ ì™œ ë”±ë”±","ë¼ˆê°€ ë”±ë”±","ë¼ˆëŠ” ì™œ ë‹¨ë‹¨","ì¹¼ìŠ˜"],
    a:`ë¼ˆëŠ” ëª¸ì„ ë²„í‹°ëŠ” ê¸°ë‘¥ì´ë¼ ë‹¨ë‹¨í•´ì•¼ í•´.
ë¼ˆì—ëŠ” ì¹¼ìŠ˜ ê°™ì€ ì„±ë¶„ì´ ë§ì•„ì„œ ë”±ë”±í•´ì ¸.`
  },
  {
    keys:["ê´€ì ˆ","ë¬´ë¦ ê´€ì ˆ","íŒ”ê¿ˆì¹˜ ê´€ì ˆ","ê´€ì ˆì´ ë­","ì™œ ì˜ êµ¬ë¶€ëŸ¬"],
    a:`ê´€ì ˆì€ ë¼ˆì™€ ë¼ˆê°€ ë§Œë‚˜ëŠ” ìë¦¬ì•¼.
ê´€ì ˆì´ ìˆì–´ì„œ íŒ”ê¿ˆì¹˜ë‚˜ ë¬´ë¦ì²˜ëŸ¼ ì˜ êµ¬ë¶€ë¦´ ìˆ˜ ìˆì–´.
ë¼ˆ ëì—ëŠ” ì—°ê³¨ì´ ìˆì–´ ë¶€ë“œëŸ½ê²Œ ì›€ì§ì´ê²Œ ë„ì™€ì¤˜.`
  },
  {
    keys:["ì—°ê³¨","ì—°ê³¨ì´ ë­","ì—°ê³¨ ì—­í• ","ì¿ ì…˜"],
    a:`ì—°ê³¨ì€ ë¼ˆ ëì— ìˆëŠ” ë§ë‘í•œ ì¿ ì…˜ ê°™ì€ ë¶€ë¶„ì´ì•¼.
ê´€ì ˆì—ì„œ ì¶©ê²©ì„ ì¤„ì´ê³  ë¼ˆë¼ë¦¬ ë¶€ë“œëŸ½ê²Œ ì›€ì§ì´ê²Œ í•´.`
  },
  {
    keys:["ê·¼ìœ¡ ì–´ë–»ê²Œ","ê·¼ìœ¡ ì›€ì§","ìˆ˜ì¶•","ì´ì™„","ê·¼ìœ¡ì€ ì–´ë–»ê²Œ ì›€ì§"],
    a:`ê·¼ìœ¡ì€ ìˆ˜ì¶•í•˜ë©´ ì§§ì•„ì§€ê³ , ì´ì™„í•˜ë©´ ê¸¸ì–´ì ¸.
ê·¼ìœ¡ì´ ìˆ˜ì¶•í•˜ë©´ì„œ ë¼ˆë¥¼ ì¡ì•„ë‹¹ê²¨ì„œ ëª¸ì´ ì›€ì§ì—¬.`
  },
  {
    keys:["ê·¼ìœ¡ ëª‡ ê°œ","ê·¼ìœ¡ ê°œìˆ˜","600ê°œ","ê·¼ìœ¡ì€ ëª‡ê°œ"],
    a:`ì‚¬ëŒ ëª¸ì—ëŠ” ê·¼ìœ¡ì´ 600ê°œ ì´ìƒ ìˆì–´.
ê±·ê¸°, í‘œì •, ìì„¸ ìœ ì§€, ìˆ¨ ì‰¬ê¸°ê¹Œì§€ ê·¼ìœ¡ì´ í•´.`
  },
  {
    keys:["ê·¼ìœ¡ ì™œ ì§","ê·¼ìœ¡ ë‘ ê°œ","ì§ìœ¼ë¡œ","êµ½íˆëŠ” ê·¼ìœ¡","í´ëŠ” ê·¼ìœ¡"],
    a:`ê·¼ìœ¡ì€ ë‹¹ê¸°ê¸°ëŠ” ì˜í•˜ì§€ë§Œ ë°€ê¸°ëŠ” ëª»í•´.
ê·¸ë˜ì„œ êµ½íˆëŠ” ê·¼ìœ¡ê³¼ í´ëŠ” ê·¼ìœ¡ì´ ì§ì„ ì´ë¤„ ë²ˆê°ˆì•„ ìˆ˜ì¶•Â·ì´ì™„í•´.`
  },
  {
    keys:["íŒ” êµ½","íŒ” ì ‘","íŒ” ì™œ ì ‘","íŒ”ì´ ì™œ êµ½","íŒ”ì„ êµ½íˆë©´","ì´ë‘","ì‚¼ë‘"],
    a:`íŒ”ì„ êµ½í ë•ŒëŠ” ì´ë‘ê·¼ì´ ìˆ˜ì¶•í•˜ê³  ì‚¼ë‘ê·¼ì´ ì´ì™„í•´.
ê·¸ë˜ì„œ ì•„ë˜íŒ”ì´ ìœ„ë¡œ ì˜¬ë¼ì™€.
íŒ”ì„ í¼ ë•ŒëŠ” ë°˜ëŒ€ë¡œ ì‚¼ë‘ê·¼ì´ ìˆ˜ì¶•í•˜ê³  ì´ë‘ê·¼ì´ ì´ì™„í•´.`
  },
  {
    keys:["í˜ì¤„","í˜ì¤„ ë­","ê·¼ìœ¡ ë¼ˆ ë¶™","ê·¼ìœ¡ì´ ë¼ˆì—","ì¤„ ê°™ì€"],
    a:`ê·¼ìœ¡ì€ í˜ì¤„ë¡œ ë¼ˆì™€ ì´ì–´ì ¸ ìˆì–´.
ê·¼ìœ¡ì´ ìˆ˜ì¶•í•˜ë©´ í˜ì¤„ì´ ë‹¹ê²¨ì§€ê³ , ë¼ˆê°€ ì›€ì§ì—¬.`
  },
  {
    keys:["ê·¼ìœ¡ ì™œ ë–¨","íŒŒë¥´ë¥´","ëœëœ","ë–¨ë¦¬ëŠ”","ë–¨ë ¤"],
    a:`ê·¼ìœ¡ì´ ì•„ì£¼ ë¹ ë¥´ê²Œ ìˆ˜ì¶•ê³¼ ì´ì™„ì„ ë°˜ë³µí•˜ë©´ ë–¨ë¦¬ëŠ” ê²ƒì²˜ëŸ¼ ë³´ì—¬.
í˜ì„ ì˜¤ë˜ ì£¼ê±°ë‚˜ í”¼ê³¤í•  ë•Œ ê·¼ìœ¡ì´ ì ê¹ ì‰¬ì§€ ëª»í•´ì„œ ë‚˜íƒ€ë‚  ìˆ˜ ìˆì–´.`
  },
  {
    keys:["ë¼ˆê°€ ì—†ìœ¼ë©´","ë¼ˆ ì—†ìœ¼ë©´","ë¼ˆê°€ ì—†","ê³¨ê²© ì—†"],
    a:`ë¼ˆê°€ ì—†ìœ¼ë©´ ëª¸ì„ ì§€íƒ±í•˜ê¸° ì–´ë ¤ì›Œì„œ í˜•íƒœë¥¼ ìœ ì§€í•˜ê¸° í˜ë“¤ì–´.
ë˜ ë‡Œë‚˜ ì‹¬ì¥ ê°™ì€ ì¤‘ìš”í•œ ê¸°ê´€ë„ ë³´í˜¸ë°›ê¸° ì–´ë ¤ì›Œ.`
  },
  {
    keys:["ê·¼ìœ¡ì´ ì—†ìœ¼ë©´","ê·¼ìœ¡ ì—†ìœ¼ë©´","ê·¼ìœ¡ì´ ì—†","ì›€ì§ì¼ ìˆ˜ ì—†"],
    a:`ê·¼ìœ¡ì´ ì—†ìœ¼ë©´ ëª¸ì„ ì›€ì§ì¼ ìˆ˜ ì—†ì–´.
ì‹¬ì¥ì´ë‚˜ ì¥ì²˜ëŸ¼ ìë™ìœ¼ë¡œ ì›€ì§ì´ëŠ” ê·¼ìœ¡ë„ ìˆì–´ì„œ ìƒëª… ìœ ì§€ë„ ì–´ë ¤ì›Œì ¸.`
  },
  {
    keys:["ìˆ¨ ì‰¬","í˜¸í¡","ìˆ¨ì‰¬ëŠ”","ìˆ¨ë„ ê·¼ìœ¡"],
    a:`ìˆ¨ ì‰¬ëŠ” ê²ƒë„ ê·¼ìœ¡ì´ í•´.
ê°€ìŠ´ê³¼ ë°° ìª½ ê·¼ìœ¡ì´ ìˆ˜ì¶•Â·ì´ì™„í•˜ë©´ì„œ ê³µê¸°ê°€ ë“¤ì–´ê°€ê³  ë‚˜ê°€.`
  },
  {
    keys:["ì‹¬ì¥ ê·¼ìœ¡","ì‹¬ì¥ë„ ê·¼ìœ¡","ì‹¬ì¥ì€ ê·¼ìœ¡"],
    a:`ì‹¬ì¥ë„ ê·¼ìœ¡ìœ¼ë¡œ ì´ë£¨ì–´ì ¸ ìˆì–´.
ì‹¬ì¥ ê·¼ìœ¡ì´ ìˆ˜ì¶•ê³¼ ì´ì™„ì„ ë°˜ë³µí•´ì„œ í”¼ë¥¼ ì˜¨ëª¸ìœ¼ë¡œ ë³´ë‚´.`
  },
];

/* ì¶”ì²œ ì§ˆë¬¸ ì¹© */
const SUGGEST=[
  "ê°€ì¥ í° ë¼ˆëŠ” ë­ì•¼?",
  "ê°ˆë¹„ë¼ˆëŠ” ëª‡ ê°œì•¼?",
  "ì†ê°€ë½ ë¼ˆëŠ” ëª‡ ê°œì•¼?",
  "ê·¼ìœ¡ì€ ì–´ë–»ê²Œ ì›€ì§ì—¬?",
  "íŒ”ì´ ì™œ êµ½í˜€ì ¸?",
  "ì™œ ê·¼ìœ¡ì´ íŒŒë¥´ë¥´ ë–¨ë ¤?",
  "ê´€ì ˆì´ ë­ì•¼?"
];

/* =========================
   5) ë§¤ì¹­ ì—”ì§„: í‚¤ì›Œë“œ ì ìˆ˜ì œ
   - ì§ˆë¬¸ì— í¬í•¨ëœ key ê°œìˆ˜(ê¸¸ì´ ê°€ì¤‘)ë¡œ ìµœê³ ì  ì„ íƒ
========================= */
function scoreMatch(qNorm, key){
  key = normalize(key);
  if(!key) return 0;
  // í¬í•¨ë˜ë©´ ì ìˆ˜: ê¸¸ì´ ë¹„ë¡€(ì§§ì€ í‚¤ì›Œë“œëŠ” ì ìˆ˜ ë‚®ê²Œ)
  if(qNorm.includes(key)){
    return Math.max(1, Math.min(8, Math.floor(key.length/2)));
  }
  return 0;
}

function getAnswer(userQ){
  const qNorm = normalize(userQ);

  let best = {score:0, a:""};
  for(const item of KB){
    let s=0;
    for(const k of item.keys){
      s += scoreMatch(qNorm, k);
    }
    if(s > best.score){
      best = {score:s, a:item.a};
    }
  }

  // ì„ê³„ê°’: ë„ˆë¬´ ì•½í•˜ë©´ ëª¨ë¥´ëŠ” ì§ˆë¬¸ ì²˜ë¦¬
  // (ëŒ€ì¶© 2~3ë‹¨ì–´ ì •ë„ ë§ì•„ì•¼ í†µê³¼)
  if(best.score < 3) return null;
  return best.a;
}

/* =========================
   6) ì§ˆë¬¸ ì¹´ìš´íŠ¸(ê²¹ì¹˜ì§€ ì•ŠëŠ” ì§ˆë¬¸ë§Œ)
========================= */
function tryCountUnique(rawQ){
  const name=getCurrentName();
  if(!name){
    addMsg("ë¨¼ì € ì˜¤ë¥¸ìª½ ìœ„ì— ì´ë¦„ì„ ì ê³  â€˜ì´ë¦„ ì„¤ì •â€™ì„ ëˆŒëŸ¬ì¤˜ ğŸ™‚","bot");
    return;
  }
  const qn=normalize(rawQ);
  if(!qn) return;

  const all=loadAll();
  const u=ensureUser(all,name);

  if(u.askedNorm.includes(qn)){
    saveAll(all);
    updateStatus();
    return;
  }

  u.askedNorm.push(qn);
  u.askedRaw.push(rawQ);
  saveAll(all);
  updateStatus();

  const count=u.askedNorm.length;
  const achieved=TITLES.find(t=>t.n===count);
  if(achieved){
    addMsg(`ğŸ–ï¸ ì¹­í˜¸ íšë“! "${achieved.t}" (ê²¹ì¹˜ì§€ ì•ŠëŠ” ì§ˆë¬¸ ${count}ê°œ)`, "bot");
  }
}

/* =========================
   7) UI
========================= */
function renderChips(){
  const chipsEl=$("#chips");
  chipsEl.innerHTML="";
  for(const s of SUGGEST){
    const c=document.createElement("div");
    c.className="chip";
    c.textContent=s;
    c.onclick=()=>{ qEl.value=s; handleAsk(); };
    chipsEl.appendChild(c);
  }
}

function handleAsk(){
  const text=qEl.value.trim();
  if(!text) return;
  addMsg(text,"me");

  tryCountUnique(text);

  const ans=getAnswer(text);
  if(ans){
    addMsg(ans,"bot");
  }else{
    addSearchButton(text);
  }

  qEl.value="";
}

$("#askBtn").addEventListener("click", handleAsk);
qEl.addEventListener("keydown", (e)=>{ if(e.key==="Enter") handleAsk(); });

$("#setNameBtn").addEventListener("click", ()=>{
  const name=nameInput.value.trim();
  if(!name){ addMsg("ì´ë¦„ì„ í•œ ê¸€ì ì´ìƒ ì ì–´ì¤˜ ğŸ™‚","bot"); return; }
  setCurrentName(name);
  const all=loadAll(); ensureUser(all,name); saveAll(all);
  updateStatus();
  addMsg(`ì¢‹ì•„! ì´ì œ "${name}" ì´ë¦„ìœ¼ë¡œ ê¸°ë¡í• ê²Œ. ì§ˆë¬¸í•´ì¤˜ ğŸ™‚`,"bot");
});

$("#resetBtn").addEventListener("click", ()=>{
  const name=getCurrentName();
  if(!name){ addMsg("ì´ˆê¸°í™”í•˜ë ¤ë©´ ë¨¼ì € ì´ë¦„ì„ ì„¤ì •í•´ì¤˜!","bot"); return; }
  const all=loadAll();
  all[name]={askedNorm:[], askedRaw:[]};
  saveAll(all); updateStatus();
  addMsg(`"${name}"ì˜ ì§ˆë¬¸ ê¸°ë¡ì„ ì´ˆê¸°í™”í–ˆì–´. ë‹¤ì‹œ ì‹œì‘!`,"bot");
});

/* ì‹œì‘ */
renderChips();
updateStatus();

const existing=getCurrentName();
if(existing){
  nameInput.value=existing;
  addMsg(`ë‹¤ì‹œ ì™”ë„¤! "${existing}" ê¸°ë¡ìœ¼ë¡œ ì‹œì‘í• ê²Œ ğŸ™‚`,"bot");
}else{
  addMsg("ì•ˆë…•! ë¨¼ì € ì˜¤ë¥¸ìª½ ìœ„ì— ì´ë¦„ì„ ì ê³  â€˜ì´ë¦„ ì„¤ì •â€™ì„ ëˆŒëŸ¬ì¤˜ ğŸ™‚","bot");
}
addMsg("ì˜ˆ) â€œíŒ”ì´ ì™œ êµ½í˜€ì ¸?â€ â€œê°€ì¥ í° ë¼ˆ ë­ì•¼?â€ â€œê·¼ìœ¡ ì™œ ë–¨ë ¤?â€","bot");
</script>
</body>
</html>